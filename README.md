# Linux Audit Viewer

Графическое приложение для просмотра, фильтрации и базового анализа журналов подсистемы аудита Linux (`auditd`).

Программа разработана в рамках курсового проекта по теме    
«Исследование возможностей подсистемы аудита Linux (auditd) для расследования инцидентов безопасности».

Фвйл отчёта по курсовой работе (РПЗ) - Отчёт.pdf

Файл с правилами для auditd - audit-viewer.rules
  
---  

## Содержание

1. [Назначение и возможности](#назначение-и-возможности)
2. [Требования к окружению](#требования-к-окружению)
3. [Структура проекта](#структура-проекта)
4. [Установка и запуск](#установка-и-запуск)
5. [Работа с журналами аудита](#работа-с-журналами-аудита)
    - [Загрузка журнала из файла](#загрузка-журнала-из-файла)
    - [Загрузка системного журнала с правами root](#загрузка-системного-журнала-с-правами-root)
6. [Описание интерфейса](#описание-интерфейса)
    - [Вкладка «События аудита»](#вкладка-события-аудита)
    - [Вкладка «Инциденты»](#вкладка-инциденты)
    - [Вкладка «Статистика»](#вкладка-статистика)
7. [Сценарии расследования инцидентов](#сценарии-расследования-инцидентов)
8. [Работа с тестовыми данными](#работа-с-тестовыми-данными)
9. [Безопасность и права доступа](#безопасность-и-права-доступа)

---  

## Назначение и возможности

**Linux Audit Viewer** предназначен для:

- визуализации журналов подсистемы аудита Linux (`auditd`);
- интерактивной фильтрации и поиска событий по различным атрибутам;
- базового анализа журналов в контексте расследования инцидентов информационной безопасности;
- начальной идентификации типовых инцидентов на основе заранее заданных сценариев;
- получения обзорной статистики по событиям аудита за выбранный период.

Основные возможности:

- загрузка журналов аудита:
    - из локального файла (офлайн-режим);
    - из системного журнала `/var/log/audit/audit.log` с повышением прав (через `pkexec`);
- табличное представление событий аудита с возможностью сортировки по столбцам;
- фильтрация событий по:
    - диапазону времени;
    - типу события (`event_type`);
    - пользователю;
    - статусу успеха (`success`); пр
    - ключу правила (`key`);
    - произвольному текстовому запросу;
- просмотр детальной структуры события и исходной строки журнала;
- вкладка **«Инциденты»** с готовыми сценариями:
    - подбор пароля по SSH;
    - изменения критичных системных файлов;
    - запуск shell от сервисного пользователя (web-shell);
- вкладка **«Статистика»**:
    - сводные показатели за период (общее количество, уникальные пользователи и типы событий, неуспешные аутентификации,
      изменения критичных файлов);
    - распределение событий по типам, пользователям и дням;
    - графики (гистограммы и линейные графики) для визуального анализа.

---  

## Требования к окружению

- Операционная система: **Linux** (дистрибутив с systemd и поддержкой `auditd`);
- Установленный Python (рекомендуется версия **3.9+**);
- Установленные пакеты Python (все необходимые пакеты содержатся в файле `requirements.txt`)
- Для работы с системным журналом аудита:
    - установленный и настроенный `auditd`;
    - установленный `polkit` (для `pkexec`);
    - возможность выполнять команды `pkexec` (пользователь должен иметь право вводить пароль root или пароль
      собственного аккаунта в зависимости от политики).

---  
  
## Структура проекта

Структура файлов исходного кода проекта:

```text
Linux-Audit-Viewer
├─ main.py                    # точка входа в приложение
├─ audit_helper.py            # вспомогательный скрипт для чтения /var/log/audit/audit.log с правами root
└─ audit_viewer/
   ├─ __init__.py
   ├─ main_window.py          # основной класс главного окна (каркас)
   ├─ events_tab.py           # логика вкладки "События аудита"
   ├─ incidents_tab.py        # логика вкладки "Инциденты"
   ├─ stats_tab.py            # логика вкладки "Статистика"
   ├─ models.py               # модели данных для таблиц
   ├─ parser.py               # разбор строк журнала auditd в структурированные события
   └─ incidents.py            # функции поиска инцидентов в массивах событий
````

---

## Установка и запуск

1. **Клонировать репозиторий** или скопировать проект в рабочий каталог:

   ```bash
   git clone https://github.com/uTakCouDeT/Linux-Audit-Viewer
   cd Linux-Audit-Viewer
   ```

2. **Создать и активировать виртуальное окружение (рекомендуется):**

   ```bash
   python3 -m venv .venv
   source venv/bin/activate
   ```

3. **Установить зависимости:**

   ```bash
   pip install -r requirements.txt
   ```

4. **Запустить приложение:**

   ```bash
   python main.py
   ```

   После запуска откроется главное окно **Linux Audit Viewer**.

---

## Работа с журналами аудита

### Загрузка журнала из файла

Этот режим не требует прав root и позволяет анализировать ранее сохранённые журналы (например, перенесённые с другой
системы).

1. В главном окне выбрать меню **«Файл» → «Открыть журнал из файла…»**.
2. В появившемся диалоговом окне указать файл журнала (обычно файлы вида `audit.log`, `audit.log.1`, и т.п.).
3. После выбора файла и подтверждения:

    * приложение распарсит содержимое;
    * при успешном разборе:

        * вкладка **«События аудита»** будет заполнена таблицей событий;
        * вкладки **«Инциденты»** и **«Статистика»** станут активными;
    * при отсутствии событий будет показано соответствующее уведомление.

### Загрузка системного журнала с правами root

Для доступа к реальному системному журналу аудита `/var/log/audit/audit.log` нужны повышенные привилегии.

1. В главном окне выбрать меню **«Файл» → «Загрузить системный журнал (root)»**.

2. При первом вызове может появиться окно `pkexec` с запросом пароля:

    * необходимо ввести пароль (root или пользователя – в зависимости от настроек `polkit`);

3. Приложение запускает вспомогательный скрипт `audit_helper.py` от имени root:

    * скрипт читает `/var/log/audit/audit.log`;
    * преобразует данные в безопасный формат JSON;
    * возвращает их в основное приложение.

4. После успешного выполнения:

    * события будут доступны во всех вкладках аналогично загрузке из файла;
    * в строке состояния отобразится количество загруженных записей.

При ошибке (например, `pkexec` не установлен или доступ запрещён) пользователь видит окно с текстом ошибки.

---

## Описание интерфейса

После загрузки журнала доступно несколько вкладок: **«События аудита»**, **«Инциденты»**, **«Статистика»**.

### Вкладка «События аудита»

Основное рабочее пространство для просмотра и фильтрации событий.
![img.png](imgs/img.png)

**Структура:**

* слева — панель фильтров;
* справа — вертикальный разделитель:

    * сверху таблица событий;
    * снизу панель подробностей по выбранному событию.

#### Панель фильтров

Позволяет сузить набор отображаемых событий. Основные элементы:

* **Время от / Время до**

    * задаётся через виджеты `QDateTimeEdit` с календарём;
    * по умолчанию диапазон выставляется автоматически по минимальному и максимальному времени в загруженном журнале;
* **Тип события**

    * выпадающий список с типами (`event_type`), обнаруженными в журнале;
    * пункт «Любой» отключает фильтрацию по типу;
* **Пользователь**

    * выпадающий список пользователей, обнаруженных в журнале;
    * пункт «Любой» отключает фильтрацию по пользователю;
* **Статус**

    * «Любой»;
    * «Только успешные» (только `success=True`);
    * «Только с ошибкой» (только `success=False`);
* **Ключ правила (key)**

    * текстовое поле; фильтрация по полю `key` (case-insensitive, по подстроке);
* **Поиск по тексту**

    * поиск по нескольким текстовым полям события (`comm`, `exe`, `raw`), без учёта регистра.

Ниже находятся кнопки:

* **«Применить»** — применить текущие значения фильтров;
* **«Сбросить»** — сбросить фильтры к исходному состоянию (диапазон времени по min/max, остальные поля — «Любой»/пусто).

#### Таблица событий

Верхняя часть правого блока — таблица, отображающая текущий набор (отфильтрованных) событий.

Возможности:

* сортировка по столбцам (клик по заголовку);
* выбор строки с последующим отображением деталей;
* при отсутствии данных показывается плейсхолдер с текстом о необходимости загрузить журнал.

#### Панель деталей события

Нижняя часть правого блока — панель подробностей выбранного события:

* оформлена в виде вкладок:

    * **«Структура»** — таблица «поле–значение», показывающая разобранные параметры события;
    * **«Сырой лог»** — исходная строка журнала auditd, из которой было получено данное событие.

---

### Вкладка «Инциденты»

Вкладка предназначена для автоматизированного поиска возможных инцидентов на основе заранее заданных сценариев.
![img_1.png](imgs/img_1.png)

**Структура:**

* слева — список сценариев;
* справа — вертикальный разделитель:

    * сверху таблица найденных событий (подозрительных в рамках выбранного сценария);
    * ниже текстовое описание сценария;
    * ещё ниже панель деталей события (структура + сырой лог), аналогичная вкладке «События аудита».

Список сценариев включает:

1. **«Подбор пароля по SSH»**
2. **«Изменения критичных файлов»**
3. **«Web-shell (shell от сервисного пользователя)»**

Работа вкладки:

* до загрузки журнала список сценариев отключён;
* после загрузки журнала и выбора сценария:

    * справа обновляется текстовое описание методики;
    * в таблицу выводятся события, удовлетворяющие условиям сценария;
    * при выборе строки отображаются подробности конкретного события.

Подробные правила работы каждого сценария описаны ниже (см. раздел
[Сценарии расследования инцидентов](#сценарии-расследования-инцидентов)).

---

### Вкладка «Статистика»

Вкладка предназначена для обзорного анализа журнала и выявления аномалий.
![img_2.png](imgs/img_2.png)

**Структура:**

* фильтр по времени (аналогичен вкладке «События аудита»);
* блок «Общая статистика»;
* три последовательно расположенных блока:

    * «Распределение событий по типам»;
    * «Распределение событий по пользователям»;
    * «Распределение событий по дням».

Интерфейс вкладки размещён внутри прокручиваемой области, что позволяет комфортно просматривать таблицы и графики на
экранах с разным разрешением.

#### Фильтр по времени

В верхней части:

* **«Время от» / «Время до»** — задаётся через `QDateTimeEdit`;
* **«Применить»** — пересчитать статистику только для указанного интервала;
* **«Сбросить»** — вернуть диапазон к минимальному и максимальному времени по журналу и пересчитать статистику.

#### Общая статистика

Отображаются следующие показатели за выбранный период:

* **Всего событий в периоде**;
* **Уникальных пользователей**;
* **Уникальных типов событий**;
* **Неуспешных аутентификаций** (события типа `USER_AUTH`/`USER_LOGIN` с `success=False`);
* **Изменений критичных файлов** (по результатам сценария «Изменения критичных файлов»).

#### Распределение событий по типам

* слева — таблица вида «тип события → количество»;
* справа — горизонтальная гистограмма:

    * по оси Y — типы событий (ограничивается верхними по частоте);
    * по оси X — количество событий.

#### Распределение событий по пользователям

* слева — таблица вида «пользователь → количество»;
* справа — горизонтальная гистограмма:

    * по оси Y — пользователи;
    * по оси X — количество событий для каждого пользователя.

#### Распределение событий по дням

* слева — таблица вида «дата → количество событий»;
* справа — линейный график:

    * по оси X — даты;
    * по оси Y — количество событий в соответствующий день.

---

## Сценарии расследования инцидентов

Вкладка **«Инциденты»** реализует три базовых сценария безопасности.

### 1. Подбор пароля по SSH

Сценарий направлен на выявление попыток подбора пароля (bruteforce) по протоколу SSH.

Критерии:

* учитываются события типов `USER_AUTH` и `USER_LOGIN`;
* анализируются только неуспешные попытки (`success=False`);
* учитываются записи, связанные с процессами SSH (например, `exe="/usr/sbin/sshd"`);
* события группируются по комбинации:

    * пользователь;
    * IP-адрес удалённого клиента;
* внутри каждой группы ищутся интервалы времени, в которых за короткий период
  происходит **не менее 5 неуспешных попыток** аутентификации.

Найденные события выводятся в таблице, пользователь может открыть детали и посмотреть исходные строки лога.

### 2. Изменения критичных файлов

Сценарий ориентирован на выявление изменений ключевых системных файлов,
от которых зависят учётные записи и безопасность системы:

* `/etc/passwd`
* `/etc/shadow`
* `/etc/group`
* `/etc/sudoers`
* `/etc/ssh/sshd_config`
  (фактический список критичных путей может отличаться, в коде задан минимальный набор)

Критерии:

* учитываются события типа `SYSCALL`;
* рассматриваются только успешные операции (`success=True`);
* анализируются параметры события (поля `details`), в которых фигурирует путь к одному из указанных критичных файлов.

Такие события могут указывать на:

* изменение паролей и учётных записей;
* модификацию конфигурации SSH;
* изменение списка пользователей и групп.

### 3. Web-shell (запуск shell от сервисного пользователя)

Сценарий позволяет обнаружить ситуации, когда веб-сервис (например, `www-data`) запускает интерактивный shell, что
характерно для эксплуатации уязвимостей веб-приложений.

Критерии:

* учитываются события типа `SYSCALL`;
* системный вызов соответствует `execve` (или его номер, в зависимости от архитектуры);
* запускаемый процесс — командная оболочка (`/bin/bash`, `/bin/sh`, `bash`, `sh` и т.п.);
* UID процесса соответствует сервисным пользователям (например, `www-data`, `nginx`, `apache`)
  либо строка пользователя содержит соответствующие обозначения.

Такие события могут свидетельствовать о том, что атакующий получил удалённый доступ к системе через web-shell.

---

## Работа с тестовыми данными

Для демонстрации работы сценариев инцидентов и статистических модулей используется специальный тестовый файл
журнала, сгенерированный на реальном сервере, содержащий:

* большое количество попыток SSH-логина (так как в реальной системе с запущенным sshd постоянно происходят попытки подключения по ssh от ботов и автоматических сканеров);
* события изменения файлов `/etc/passwd` и `/etc/ssh/sshd_config`;
* запуск `/bin/bash` от имени сервисного пользователя.

Рекомендации по использованию:

1. В корневой папке проекта содержится тестовый файл `server.log` содержащий лог сервера.
2. Загрузить файл через **«Файл» → «Открыть журнал из файла…»**.
3. Перейти на вкладки **«Инциденты»** и **«Статистика»** и убедиться, что:

    * сценарии находят ожидаемые события;
    * статистика корректно отражает распределения по типам, пользователям и датам.

Такой подход позволяет тестировать функциональность приложения на заранее известном наборе случаев, не затрагивая
реальную систему.

---

## Безопасность и права доступа

При работе с системным журналом `/var/log/audit/audit.log` приложение использует:

* утилиту `pkexec` (часть `polkit`) для запуска вспомогательного скрипта `audit_helper.py` с правами `root`;
* `audit_helper.py` отвечает только за:

    * чтение файла журнала;
    * разбор строк;
    * сериализацию результата в JSON-формате для передачи приложению.

Рекомендации:

* запускать приложение из-под обычного пользователя;
* внимательно относиться к окнам запроса пароля (`pkexec`)
  и не предоставлять права, если команда или путь к исполняемому файлу вызывают сомнения;
* для анализа журналов с реального сервера возможно копирование файлов журнала на отдельную «рабочую» станцию и
  использование приложения в режиме загрузки из файла.

---

**Linux Audit Viewer** может рассматриваться как учебный пример практического использования подсистемы аудита Linux и
как основа для дальнейшего развития:

* подключения баз данных;
* расширения набора сценариев выявления инцидентов;
* углублённой аналитики и построения отчётов.

---

Copyright © 2025 uTakCouDeT. Все права защищены.
